const mongoose=require("mongoose"),composeThingSchemaProperties=require("./composeThingSchemaProperties"),{Schema}=mongoose,thingSchemas={},createThingSchema=a=>{const{name:b,geospatialFields:c}=a;if(thingSchemas[b])return thingSchemas[b];const d=composeThingSchemaProperties(a),e=new Schema(d,{timestamps:!0});return c&&c.forEach(({name:a,type:b})=>{"Point"===b?e.pre("save",function(b){0===this[a].coordinates.length&&(this[a].coordinates=void 0),b()}):e.index({[a]:"2dsphere"})}),mongoose.model(b,e),thingSchemas[b]=e,e};module.exports=createThingSchema;