const createThingSchema=require("../../mongooseModels/createThingSchema"),processDeleteData=require("./processDeleteData"),createDeleteThingMutationResolver=a=>{return async(b,c,d)=>{const{where:e}=c,{mongooseConn:f}=d,{name:g}=a,h=createThingSchema(a),i=f.model(g,h),j=Object.keys(e);if(1!==j.length)throw new TypeError("Expected exactly one key in where arg!");const k=e.id?{_id:e.id}:e,l=await i.findOne(k,null,{lean:!0});if(!l)return null;const{_id:m}=l;await i.findOneAndDelete({_id:m});const n=[],o=processDeleteData(l,a);return o.forEach((a,b)=>{const{name:c}=b,d=createThingSchema(b),e=f.model(c,d);n.push(e.bulkWrite(a))}),await Promise.all(n),l.id=m,l}};module.exports=createDeleteThingMutationResolver;